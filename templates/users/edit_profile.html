{% extends 'base.html' %}

{% block title %}Edit Profile - Smart Course Registration{% endblock %}

{% block content %}
<style>
    .edit-profile-card {
        animation: fadeInUp 0.6s ease;
    }

    fieldset {
        border: 1px solid var(--border-color);
        border-radius: var(--radius-lg);
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        background: var(--bg-secondary);
    }

    fieldset legend {
        font-size: 1.125rem;
        font-weight: 700;
        color: var(--text-primary);
        padding: 0 0.75rem;
        width: auto;
        margin-bottom: 0;
        float: none;
    }

    .avatar-preview {
        position: relative;
        display: inline-block;
    }

    .avatar-preview img {
        border-radius: var(--radius-lg);
        border: 3px solid var(--primary-start);
        box-shadow: var(--shadow-md);
    }

    .form-label {
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 0.5rem;
    }

    .form-label i {
        margin-right: 0.5rem;
    }
</style>

<div class="row justify-content-center">
    <div class="col-md-10">
        <div class="card edit-profile-card">
            <div class="card-header" style="background: var(--primary-gradient); color: white; border: none;">
                <h4 class="mb-0" style="color: white; font-weight: 700;">
                    <i class="fas fa-user-edit"></i> Edit Profile
                </h4>
            </div>
            <div class="card-body p-4">
                <form method="POST" enctype="multipart/form-data" id="profileForm">
                    {% csrf_token %}

                    <fieldset>
                        <legend><i class="fas fa-user-circle text-primary"></i> Account Information</legend>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="{{ u_form.username.id_for_label }}" class="form-label">
                                    <i class="fas fa-at"></i> Username
                                </label>
                                {{ u_form.username }}
                                {% if u_form.username.errors %}
                                <div class="text-danger mt-1"><i class="fas fa-exclamation-circle"></i> {{
                                    u_form.username.errors }}</div>
                                {% endif %}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="{{ u_form.email.id_for_label }}" class="form-label">
                                    <i class="fas fa-envelope"></i> Email
                                </label>
                                {{ u_form.email }}
                                {% if u_form.email.errors %}
                                <div class="text-danger mt-1"><i class="fas fa-exclamation-circle"></i> {{
                                    u_form.email.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </fieldset>

                    <fieldset>
                        <legend><i class="fas fa-image text-primary"></i> Profile Picture</legend>
                        <div class="mb-3">
                            {% if user.profile.avatar %}
                            <div class="avatar-preview mb-3">
                                <img src="{{ user.profile.avatar.url }}" alt="Current Avatar" id="avatarPreview"
                                    style="max-width: 150px;">
                            </div>
                            {% endif %}
                            <label for="{{ p_form.avatar.id_for_label }}" class="form-label">
                                <i class="fas fa-upload"></i> Upload New Picture
                            </label>
                            {{ p_form.avatar }}
                            {% if p_form.avatar.errors %}
                            <div class="text-danger mt-1"><i class="fas fa-exclamation-circle"></i> {{
                                p_form.avatar.errors }}</div>
                            {% endif %}
                            <small class="form-text text-muted d-block mt-1">
                                <i class="fas fa-info-circle"></i> Recommended: Square image, at least 200x200 pixels
                            </small>
                        </div>
                    </fieldset>

                    <fieldset>
                        <legend><i class="fas fa-phone text-primary"></i> Contact Information</legend>
                        <div class="mb-3">
                            <label for="{{ p_form.phone_number.id_for_label }}" class="form-label">
                                <i class="fas fa-mobile-alt"></i> Phone Number
                            </label>
                            {{ p_form.phone_number }}
                            {% if p_form.phone_number.errors %}
                            <div class="text-danger mt-1"><i class="fas fa-exclamation-circle"></i> {{
                                p_form.phone_number.errors }}</div>
                            {% endif %}
                        </div>
                    </fieldset>

                    <fieldset>
                        <legend><i class="fas fa-id-card text-primary"></i> Personal Information</legend>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="{{ p_form.date_of_birth.id_for_label }}" class="form-label">
                                    <i class="fas fa-birthday-cake"></i> Date of Birth
                                </label>
                                {{ p_form.date_of_birth }}
                                {% if p_form.date_of_birth.errors %}
                                <div class="text-danger mt-1"><i class="fas fa-exclamation-circle"></i> {{
                                    p_form.date_of_birth.errors }}</div>
                                {% endif %}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="{{ p_form.address.id_for_label }}" class="form-label">
                                    <i class="fas fa-map-marker-alt"></i> Address
                                </label>
                                {{ p_form.address }}
                                {% if p_form.address.errors %}
                                <div class="text-danger mt-1"><i class="fas fa-exclamation-circle"></i> {{
                                    p_form.address.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="{{ p_form.city.id_for_label }}" class="form-label">
                                    <i class="fas fa-city"></i> City
                                </label>
                                {{ p_form.city }}
                                {% if p_form.city.errors %}
                                <div class="text-danger mt-1"><i class="fas fa-exclamation-circle"></i> {{
                                    p_form.city.errors }}</div>
                                {% endif %}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="{{ p_form.country.id_for_label }}" class="form-label">
                                    <i class="fas fa-globe"></i> Country
                                </label>
                                {{ p_form.country }}
                                {% if p_form.country.errors %}
                                <div class="text-danger mt-1"><i class="fas fa-exclamation-circle"></i> {{
                                    p_form.country.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </fieldset>

                    <fieldset>
                        <legend><i class="fas fa-info-circle text-primary"></i> About</legend>
                        <div class="mb-3">
                            <label for="{{ p_form.bio.id_for_label }}" class="form-label">
                                <i class="fas fa-align-left"></i> Bio
                            </label>
                            {{ p_form.bio }}
                            {% if p_form.bio.errors %}
                            <div class="text-danger mt-1"><i class="fas fa-exclamation-circle"></i> {{ p_form.bio.errors
                                }}</div>
                            {% endif %}
                        </div>
                    </fieldset>

                    <fieldset>
                        <legend><i class="fas fa-share-alt text-primary"></i> Social Media Links</legend>
                        <div class="mb-3">
                            <label for="{{ p_form.linkedin_url.id_for_label }}" class="form-label">
                                <i class="fab fa-linkedin" style="color: #0077b5;"></i> LinkedIn URL
                            </label>
                            {{ p_form.linkedin_url }}
                            {% if p_form.linkedin_url.errors %}
                            <div class="text-danger mt-1"><i class="fas fa-exclamation-circle"></i> {{
                                p_form.linkedin_url.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="mb-3">
                            <label for="{{ p_form.github_url.id_for_label }}" class="form-label">
                                <i class="fab fa-github"></i> GitHub URL
                            </label>
                            {{ p_form.github_url }}
                            {% if p_form.github_url.errors %}
                            <div class="text-danger mt-1"><i class="fas fa-exclamation-circle"></i> {{
                                p_form.github_url.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="mb-3">
                            <label for="{{ p_form.twitter_url.id_for_label }}" class="form-label">
                                <i class="fab fa-twitter" style="color: #1da1f2;"></i> Twitter URL
                            </label>
                            {{ p_form.twitter_url }}
                            {% if p_form.twitter_url.errors %}
                            <div class="text-danger mt-1"><i class="fas fa-exclamation-circle"></i> {{
                                p_form.twitter_url.errors }}</div>
                            {% endif %}
                        </div>
                    </fieldset>

                    <div class="d-flex justify-content-between mt-4">
                        <a href="{% url 'profile' %}" class="btn btn-secondary hover-lift">
                            <i class="fas fa-times"></i> Cancel
                        </a>
                        <button type="submit" class="btn btn-primary hover-lift" id="submitBtn">
                            <i class="fas fa-save"></i> Save Changes
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    // Add loading state to submit button
    document.getElementById('profileForm').addEventListener('submit', function () {
        const btn = document.getElementById('submitBtn');
        btn.classList.add('btn-loading');
        btn.disabled = true;
    });

    // Image preview functionality
    const avatarInput = document.querySelector('input[type="file"][name="avatar"]');
    if (avatarInput) {
        avatarInput.addEventListener('change', function (e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    let preview = document.getElementById('avatarPreview');
                    if (!preview) {
                        preview = document.createElement('img');
                        preview.id = 'avatarPreview';
                        preview.style.maxWidth = '150px';
                        preview.className = 'img-thumbnail mb-3 d-block';
                        avatarInput.parentElement.insertBefore(preview, avatarInput);
                    }
                    preview.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        });
    }
</script>
{% endblock %}