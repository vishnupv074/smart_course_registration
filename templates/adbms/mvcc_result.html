{% extends 'base.html' %}

{% block title %}{{ results.demo_name }} - SmartReg{% endblock %}

{% block content %}
<style>
    .demo-result-card {
        animation: fadeInUp 0.6s ease;
    }

    .config-card {
        background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
        border-left: 4px solid var(--primary-start);
    }

    .concept-card {
        background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(99, 102, 241, 0.1) 100%);
        border-left: 4px solid var(--info);
    }

    .execution-table {
        font-family: var(--font-mono);
        font-size: 0.875rem;
    }

    .execution-table th {
        background: var(--bg-tertiary);
        font-weight: 700;
        text-transform: uppercase;
        font-size: 0.75rem;
        letter-spacing: 0.05em;
    }

    .execution-table tbody tr {
        transition: all var(--transition-fast);
    }

    .execution-table tbody tr:hover {
        background: var(--bg-tertiary);
        transform: scale(1.01);
    }

    .version-card {
        background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(110, 231, 183, 0.1) 100%);
        border-left: 4px solid var(--success);
        border-radius: var(--radius-lg);
        padding: 1.25rem;
        margin-bottom: 1rem;
    }

    .system-column-badge {
        font-family: var(--font-mono);
        font-size: 0.8rem;
        padding: 0.35rem 0.75rem;
        border-radius: var(--radius-md);
        background: var(--bg-tertiary);
        border: 1px solid var(--border-color);
    }

    .conclusion-card {
        border-radius: var(--radius-xl);
        padding: 1.5rem;
        background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(110, 231, 183, 0.1) 100%);
        border-left: 4px solid var(--success);
    }

    .step-details {
        font-size: 0.85rem;
        color: var(--text-tertiary);
        font-family: var(--font-mono);
        margin-top: 0.25rem;
    }

    .mvcc-highlight {
        background: linear-gradient(135deg, rgba(245, 158, 11, 0.2) 0%, rgba(251, 191, 36, 0.2) 100%);
        padding: 0.15rem 0.5rem;
        border-radius: var(--radius-sm);
        font-weight: 600;
    }
</style>

<div class="row justify-content-center">
    <div class="col-md-10">
        <div class="demo-result-card">
            <div class="card mb-3">
                <div class="card-header" style="background: var(--primary-gradient); color: white; border: none;">
                    <h4 class="mb-0" style="color: white; font-weight: 700;">
                        <i class="fas fa-code-branch"></i> {{ results.demo_name }} Demo
                    </h4>
                </div>
            </div>

            <div class="card config-card mb-4">
                <div class="card-body">
                    <h5 class="mb-3"><i class="fas fa-cog text-primary"></i> Configuration</h5>
                    <div class="row">
                        <div class="col-md-4">
                            <strong><i class="fas fa-layer-group"></i> Isolation Level:</strong><br>
                            <span class="badge badge-gradient mt-1">{{ results.isolation_level }}</span>
                        </div>
                        <div class="col-md-4">
                            <strong><i class="fas fa-hashtag"></i> Target Section ID:</strong><br>
                            <code class="mt-1">{{ results.section_id }}</code>
                        </div>
                        <div class="col-md-4">
                            <strong><i class="fas fa-database"></i> Initial Capacity:</strong><br>
                            <code class="mt-1">{{ results.initial_value }}</code>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card concept-card mb-4">
                <div class="card-body">
                    <h5 class="mb-3"><i class="fas fa-lightbulb text-info"></i> Concept Explained</h5>
                    <p class="mb-3">{{ results.description }}</p>
                    <div class="row">
                        <div class="col-md-4">
                            <strong><i class="fas fa-fingerprint"></i> xmin:</strong><br>
                            <small>Transaction ID that created this row version</small>
                        </div>
                        <div class="col-md-4">
                            <strong><i class="fas fa-times-circle"></i> xmax:</strong><br>
                            <small>Transaction ID that deleted/updated this row (0 if current)</small>
                        </div>
                        <div class="col-md-4">
                            <strong><i class="fas fa-map-marker-alt"></i> ctid:</strong><br>
                            <small>Physical location (page, tuple) of row version</small>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card mb-4">
                <div class="card-header" style="background: var(--bg-tertiary); font-weight: 700;">
                    <i class="fas fa-list-alt"></i> Execution Timeline
                </div>
                <div class="table-responsive">
                    <table class="table execution-table mb-0">
                        <thead>
                            <tr>
                                <th><i class="fas fa-clock"></i> Time</th>
                                <th><i class="fas fa-shoe-prints"></i> Step</th>
                                <th><i class="fas fa-play"></i> Action</th>
                                <th><i class="fas fa-database"></i> Value</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for step in results.steps %}
                            <tr>
                                <td>{{ step.time }}</td>
                                <td><span class="badge bg-secondary">{{ step.step }}</span></td>
                                <td>
                                    {{ step.action }}
                                    {% if step.details %}
                                    <div class="step-details">{{ step.details }}</div>
                                    {% endif %}
                                </td>
                                <td><strong class="gradient-text">{{ step.value }}</strong></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="card mb-4">
                <div class="card-header" style="background: var(--bg-tertiary); font-weight: 700;">
                    <i class="fas fa-layer-group"></i> Row Versions Comparison
                </div>
                <div class="card-body">
                    <p class="text-muted mb-3">
                        <i class="fas fa-info-circle"></i> PostgreSQL maintains multiple versions of the same row
                        simultaneously.
                        Each transaction sees the appropriate version based on its snapshot.
                    </p>
                    <div class="row">
                        {% for version in results.row_versions %}
                        <div class="col-md-6">
                            <div class="version-card">
                                <h6 class="mb-3"><i class="fas fa-code-branch"></i> {{ version.version }}</h6>
                                <div class="mb-2">
                                    <strong>Capacity:</strong>
                                    <span class="mvcc-highlight">{{ version.capacity }}</span>
                                </div>
                                <div class="mb-2">
                                    <strong>System Columns:</strong>
                                </div>
                                <div class="d-flex gap-2 flex-wrap">
                                    <span class="system-column-badge">
                                        <i class="fas fa-fingerprint"></i> xmin: {{ version.xmin }}
                                    </span>
                                    <span class="system-column-badge">
                                        <i class="fas fa-times-circle"></i> xmax: {{ version.xmax }}
                                    </span>
                                    <span class="system-column-badge">
                                        <i class="fas fa-map-marker-alt"></i> ctid: {{ version.ctid }}
                                    </span>
                                </div>
                                <div class="mt-3">
                                    <small class="text-muted">
                                        <i class="fas fa-eye"></i> Visible to: <strong>{{ version.visible_to }}</strong>
                                    </small>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <div class="conclusion-card">
                <h4 class="alert-heading">
                    <i class="fas fa-check-circle"></i> Conclusion
                </h4>
                <p class="mb-0">{{ results.conclusion }}</p>
            </div>

            <div class="text-center mt-4">
                <a href="{% url 'adbms-dashboard' %}" class="btn btn-secondary hover-lift">
                    <i class="fas fa-arrow-left"></i> Back to Dashboard
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}